"""
{{DISPLAY_NAME}}

{{ROLE}}
"""

import json
import logging
from datetime import datetime

from ano_core.errors import AgentExecutionError
from ano_core.types import AgentInput, AgentOutput
from agent_framework.base_agent import BaseAgent
from registry.agent_registry import register_agent

logger = logging.getLogger(__name__)


@register_agent(
    name="{{AGENT_NAME}}",
    team="{{TEAM}}",
    version="1.0.0",
    capabilities={{CAPABILITIES}},
    description="{{ROLE}}",
)
class {{CLASS_NAME}}(BaseAgent):
    """
    {{DISPLAY_NAME}}

    {{ROLE}}

    Capabilities: {{CAPABILITIES}}
    """

    agent_name = "{{AGENT_NAME}}"
    version = "1.0.0"

    def get_system_prompt(self) -> str:
        """Return the agent system prompt."""
        return """{{PERSONALITY}}

Your role is to {{ROLE}}.

Capabilities:
{{CAPABILITIES}}

Provide clear, actionable responses based on the input provided."""

    async def execute(self, agent_input: AgentInput) -> AgentOutput:
        """
        Execute the agent's primary task.

        Args:
            agent_input: Input data and context

        Returns:
            AgentOutput with results and metadata

        Raises:
            AgentExecutionError: If execution fails
        """
        started_at = datetime.utcnow()

        try:
            # Extract input data
            input_data = agent_input.data

            # Build user prompt
            user_prompt = self._build_prompt(input_data)

            # Call LLM
            logger.info(f"{self.agent_name}: Processing request")
            response_text = await self.call_llm(
                user_prompt=user_prompt,
                max_tokens=4096,
                temperature=0.3,
            )

            # Parse response
            result = self.parse_json_response(response_text)

            # Create metadata
            metadata = self.get_metadata()

            return AgentOutput(
                result=result,
                metadata=metadata,
            )

        except Exception as e:
            logger.error(f"{self.agent_name}: Execution failed: {e}")
            raise AgentExecutionError(
                f"Execution failed: {e}",
                agent_name=self.agent_name,
            ) from e

    def _build_prompt(self, input_data: dict) -> str:
        """Build the user prompt from input data."""
        # Customize this method based on your agent's needs
        return json.dumps(input_data, indent=2)
